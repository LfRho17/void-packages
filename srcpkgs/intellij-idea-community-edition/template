# Template file for 'intellij-idea-community-edition'
pkgname=intellij-idea-community-edition
version=2025.3.1
revision=1
archs="x86_64"
depends="virtual?java-environment giflib libXtst hicolor-icon-theme libdbusmenu-glib"
short_desc="Java integrated development environment by JetBrains"
maintainer="Bnyro <bnyro@tutanota.com>"
license="Apache-2.0"
homepage="https://www.jetbrains.org/"
distfiles="https://download.jetbrains.com/idea/idea-${version}.tar.gz"
checksum=21e1b90b5ec684767a03498ba424ef3f9acc5dbf759cceefd5edd474f043ad6c
repository=nonfree
nopie=yes
python_version=3
skiprdeps="/usr/lib/intellij-idea/plugins/Kotlin/bin/linux/LLDBFrontend"

post_extract() {
	cat > entry.desktop <<EOF
[Desktop Entry]
Version=1.0
Type=Application
Name=IntelliJ IDEA Community Edition
Comment=Develop with pleasure!
Exec=/usr/bin/idea %f
Icon=idea
Terminal=false
StartupNotify=true
StartupWMClass=jetbrains-idea-ce
Categories=Development;IDE;Java;
EOF
}

do_install() {
	vmkdir usr/bin
	vmkdir usr/share/doc/intellij-idea
	vmkdir usr/lib/intellij-idea
	vmkdir usr/share/pixmaps
	vmkdir usr/share/icons/hicolor/scalable/apps

	mv bin lib plugins product-info.json build.txt jbr ${DESTDIR}/usr/lib/intellij-idea
	mv license ${DESTDIR}/usr/share/doc/intellij-idea

	cd ${DESTDIR}/usr/lib/intellij-idea

	find . -type d -name "*aarch64*" -exec rm -rf {} +
	find . -type d -name "*arm64*" -exec rm -rf {} +
	find . -type d -name "*armv*" -exec rm -rf {} +
	find . -type d -name "*mips*" -exec rm -rf {} +
	find . -type d -name "*ppc64*" -exec rm -rf {} +

	find . -type d -name "*darwin*" -exec rm -rf {} +
	find . -type d -name "*macos*" -exec rm -rf {} +
	find . -type d -name "*windows*" -exec rm -rf {} +
	find . -type d -name "*win32*" -exec rm -rf {} +

	find . -name "*.exe" -delete
	find . -name "*.dll" -delete
	find . -name "*.dylib" -delete
	rm -f plugins/webp/lib/libwebp/linux/libwebp_jni.so

	cd -

	ln -sf /usr/lib/intellij-idea/bin/idea ${DESTDIR}/usr/bin/idea

	ln -sf /usr/lib/intellij-idea/bin/idea.png ${DESTDIR}/usr/share/pixmaps
	ln -sf /usr/lib/intellij-idea/bin/idea.svg ${DESTDIR}/usr/share/icons/hicolor/scalable/apps
	vinstall entry.desktop 644 usr/share/applications idea.desktop
}
